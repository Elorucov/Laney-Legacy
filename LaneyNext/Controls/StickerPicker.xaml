<UserControl
    x:Class="Elorucov.Laney.Controls.StickerPicker"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Controls"
    xmlns:mdl="using:Elorucov.Laney.DataModels"
    xmlns:obj="using:ELOR.VKAPILib.Objects"
    xmlns:vkui="using:VK.VKUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="282"
    d:DesignWidth="296" Background="{ThemeResource VKBackgroundContentBrush}" Loaded="InitStickers">

    <UserControl.Resources>
        <DataTemplate x:Key="StickersTemplate" x:DataType="mdl:StickersPack">
            <GridView HorizontalAlignment="Center" Padding="0,4,0,0" ShowsScrollingPlaceholders="False" IsItemClickEnabled="True" ItemsSource="{x:Bind Stickers}" SelectionMode="None" ItemContainerStyle="{StaticResource StickerItemStyle}" ItemClick="SelectSticker">
                <GridView.ItemTemplate>
                    <DataTemplate x:DataType="obj:Sticker">
                        <Image Width="64" Height="64" Margin="4" Opacity="{x:Bind IsAllowed, Converter={StaticResource bto}}" ToolTipService.ToolTip="{x:Bind StickerId}">
                            <Image.Source>
                                <BitmapImage DecodePixelType="Logical" DecodePixelHeight="64" DecodePixelWidth="64" UriSource="{x:Bind Images[1].Uri}"/>
                            </Image.Source>
                        </Image>
                    </DataTemplate>
                </GridView.ItemTemplate>
            </GridView>
        </DataTemplate>
    </UserControl.Resources>

    <Grid Height="282" Width="296">
        <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="36"/>
        </Grid.RowDefinitions>
        <FlipView ItemsSource="{Binding ItemsSource, ElementName=Items, Mode=OneWay}" Background="Transparent" ItemTemplate="{StaticResource StickersTemplate}" SelectedItem="{Binding SelectedItem, ElementName=Items, Mode=TwoWay}"/>
        <ListView x:Name="Items" Grid.Row="1" BorderBrush="{ThemeResource VKUIFlyoutSeparatorBrush}" BorderThickness="0,1,0,0" ShowsScrollingPlaceholders="False" ScrollViewer.BringIntoViewOnFocusChange="True" ScrollViewer.IsDeferredScrollingEnabled="True" ScrollViewer.HorizontalScrollBarVisibility="Hidden" UseSystemFocusVisuals="False" ItemContainerStyle="{StaticResource StickerFlyoutItemsStyle}" ScrollViewer.VerticalScrollMode="Disabled" ScrollViewer.IsHorizontalScrollChainingEnabled="True" ScrollViewer.HorizontalScrollMode="Enabled" ScrollViewer.IsHorizontalRailEnabled="True" SelectionMode="Single">
            <ListView.ItemContainerTransitions>
                <TransitionCollection>
                    <EntranceThemeTransition FromHorizontalOffset="18" FromVerticalOffset="0" IsStaggeringEnabled="True"/>
                </TransitionCollection>
            </ListView.ItemContainerTransitions>
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsStackPanel ItemsUpdatingScrollMode="KeepScrollOffset" Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="mdl:StickersPack">
                    <Grid Width="36" Height="36" ToolTipService.ToolTip="{Binding Title}">
                        <Image Width="24" Height="24" VerticalAlignment="Center" HorizontalAlignment="Center" Stretch="Uniform">
                            <Image.Source>
                                <BitmapImage DecodePixelHeight="24" DecodePixelWidth="24" DecodePixelType="Logical" UriSource="{x:Bind Preview}"/>
                            </Image.Source>
                        </Image>
                        <ContentPresenter Width="24" Height="24" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="{ThemeResource VKIconOutlineSecondaryBrush}" ContentTemplate="{x:Bind Icon}"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        <Border x:Name="loader" Grid.RowSpan="2" Background="Transparent">
            <vkui:Spinner Foreground="{ThemeResource VKHeaderTintBrush}" Width="44" Height="44"/>
        </Border>
    </Grid>
</UserControl>
