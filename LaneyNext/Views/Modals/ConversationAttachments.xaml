<elor:Modal
    x:Class="Elorucov.Laney.Views.Modals.ConversationAttachments"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Views.Modals"
    xmlns:elor="using:Elorucov.Toolkit.UWP.Controls"
    xmlns:ctrl="using:Elorucov.Laney.Controls"
    xmlns:msgatch="using:Elorucov.Laney.Controls.Attachments"
    xmlns:vkui="using:VK.VKUI.Controls"
    xmlns:vk="using:ELOR.VKAPILib.Objects"
    xmlns:wct="using:Elorucov.Laney.Controls.WinComToolkit"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Style="{StaticResource VKUIFullModalStyle}">

    <elor:Modal.Resources>
        <DataTemplate x:Key="PhotoTemplate" x:DataType="vk:ConversationAttachment">
            <ctrl:ClickableImage IsHitTestVisible="False" MaxWidth="105" Image="{x:Bind Attachment.Photo}"/>
        </DataTemplate>
        <DataTemplate x:Key="VideoTemplate" x:DataType="vk:ConversationAttachment">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Border Background="#7f7f7f7f" Height="92">
                    <Grid MaxWidth="228" CornerRadius="4">
                        <Grid.Background>
                            <ImageBrush Stretch="UniformToFill">
                                <ImageBrush.ImageSource>
                                    <BitmapImage UriSource="{x:Bind Attachment.Video.PreviewImageUri}" DecodePixelType="Logical" DecodePixelHeight="92"/>
                                </ImageBrush.ImageSource>
                            </ImageBrush>
                        </Grid.Background>
                        <StackPanel x:Name="VideoDurationContainer" CornerRadius="3" Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="4" Background="#7f000000" Visibility="{x:Bind Attachment.Video.DurationTime, Converter={StaticResource ntv}}">
                            <TextBlock x:Name="VideoDuration" VerticalAlignment="Center" LineHeight="17" Foreground="White" Margin="5,0" FontSize="12" Text="{x:Bind Attachment.Video.DurationTime, Converter={StaticResource dts}}"/>
                        </StackPanel>
                    </Grid>
                </Border>
                <StackPanel Grid.Row="1">
                    <TextBlock Text="{x:Bind Attachment.Video.Title}" TextTrimming="CharacterEllipsis" Foreground="{ThemeResource VKTextPrimaryBrush}"/>
                    <TextBlock Text="{x:Bind Attachment.Video.Views, Converter={StaticResource ctr}, ConverterParameter=views}" TextTrimming="CharacterEllipsis" FontSize="13" Foreground="{ThemeResource VKTextSecondaryBrush}"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="AudioTemplate" x:DataType="vk:ConversationAttachment">
            <msgatch:AudioControl Margin="-50,8,-50,8" Audio="{x:Bind Attachment.Audio}"/>
        </DataTemplate>
        <DataTemplate x:Key="DocTemplate" x:DataType="vk:ConversationAttachment">
            <Grid Height="48" Margin="0,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <ContentControl Margin="0,0,8,0" Content="{x:Bind Attachment.Document, Converter={StaticResource dic}}"/>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{x:Bind Attachment.Document.Title}" TextTrimming="CharacterEllipsis" FontWeight="SemiBold" Foreground="{ThemeResource VKTextPrimaryBrush}"/>
                    <TextBlock Text="{x:Bind Attachment.Document.Size, Converter={StaticResource fzc}}" Foreground="{ThemeResource VKTextSecondaryBrush}"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="LinkTemplate" x:DataType="vk:ConversationAttachment">
            <Grid Height="64" Margin="0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <Grid Margin="0,0,12,0" Background="#3f7f7f7f" Width="96" Height="64" CornerRadius="8">
                    <vkui:VKIcon Width="28" Height="28" Id="Icon28LinkOutline" Foreground="{ThemeResource VKAccentBrush}"/>
                    <Image HorizontalAlignment="Center" VerticalAlignment="Center" Stretch="UniformToFill">
                        <Image.Source>
                            <BitmapImage DecodePixelType="Logical" UriSource="{x:Bind Attachment.Link.Photo.PreviewImageUri}"/>
                        </Image.Source>
                    </Image>
                </Grid>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock FontWeight="SemiBold" TextWrapping="Wrap" MaxLines="2" Text="{x:Bind Attachment.Link.Title}"/>
                    <TextBlock Opacity="0.7" Text="{x:Bind Attachment.Link.Url}"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
        <!--<DataTemplate x:Key="AudioMessageTemplate" x:DataType="vk:ConversationAttachment">
            <msgatch:VoiceMessageControl Margin="0,8" AudioMessage="{x:Bind Attachment.AudioMessage}" ToolTipService.ToolTip="{x:Bind Attachment.AudioMessage.Transcript}"/>
        </DataTemplate>-->
    </elor:Modal.Resources>
    
    <Pivot x:Name="ThePivot" SelectionChanged="LoadPivotContents">
        <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=conv_attaches_photo}">
            <Grid Margin="4,0" DataContext="{Binding Photos}">
                <wct:AdaptiveGridView x:Name="PhotosGrid" VerticalAlignment="Top" Margin="0,10,0,0" ItemHeight="70" DesiredWidth="104" StretchContentForSingleRow="False" SelectionMode="None" IsItemClickEnabled="True" ItemTemplate="{StaticResource PhotoTemplate}" ItemsSource="{Binding Items}" ItemClick="OnItemClick">
                    <wct:AdaptiveGridView.Footer>
                        <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsLoading}"/>
                    </wct:AdaptiveGridView.Footer>
                </wct:AdaptiveGridView>
                <vkui:Placeholder
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
            </Grid>
        </PivotItem>
        <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=conv_attaches_video}">
            <Grid Margin="4,0" DataContext="{Binding Videos}">
                <wct:AdaptiveGridView x:Name="VideosGrid" VerticalAlignment="Top" Margin="0,10,0,0" ItemHeight="132" DesiredWidth="164" StretchContentForSingleRow="False" IsItemClickEnabled="True" ItemTemplate="{StaticResource VideoTemplate}" ItemsSource="{Binding Items}" ItemClick="OnItemClick">
                    <wct:AdaptiveGridView.Footer>
                        <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsLoading}"/>
                    </wct:AdaptiveGridView.Footer>
                </wct:AdaptiveGridView>
                <vkui:Placeholder
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
            </Grid>
        </PivotItem>
        <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=conv_attaches_audio}">
            <Grid Margin="4,0" DataContext="{Binding Audios}">
                <ListView x:Name="AudiosList" VerticalAlignment="Top" Margin="0,10,0,0" IsItemClickEnabled="True" ItemContainerStyle="{StaticResource VKUIListViewItemStyle}" ItemTemplate="{StaticResource AudioTemplate}" ItemsSource="{Binding Items}" ItemClick="OnItemClick">
                    <ListView.Footer>
                        <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsLoading}"/>
                    </ListView.Footer>
                </ListView>
                <vkui:Placeholder
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
            </Grid>
        </PivotItem>
        <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=conv_attaches_docs}">
            <Grid Margin="4,0" DataContext="{Binding Documents}">
                <ListView x:Name="DocsList" VerticalAlignment="Top" Margin="0,10,0,0" IsItemClickEnabled="True" ItemContainerStyle="{StaticResource VKUIListViewItemStyle}" ItemTemplate="{StaticResource DocTemplate}" ItemsSource="{Binding Items}" ItemClick="OnItemClick">
                    <ListView.Footer>
                        <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsLoading}"/>
                    </ListView.Footer>
                </ListView>
                <vkui:Placeholder VerticalAlignment="Stretch" 
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
            </Grid>
        </PivotItem>
        <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=conv_attaches_links}">
            <Grid Margin="4,0" DataContext="{Binding Share}">
                <ListView x:Name="ShareList" VerticalAlignment="Top" Margin="0,10,0,0" IsItemClickEnabled="True" ItemContainerStyle="{StaticResource VKUIListViewItemStyle}" ItemTemplate="{StaticResource LinkTemplate}" ItemsSource="{Binding Items}" ItemClick="OnItemClick">
                    <ListView.Footer>
                        <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsLoading}"/>
                    </ListView.Footer>
                </ListView>
                <vkui:Placeholder VerticalAlignment="Stretch" 
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
            </Grid>
        </PivotItem>
        <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=conv_attaches_graffities}">
            <Grid Margin="4,0" DataContext="{Binding Graffities}">
                <wct:AdaptiveGridView x:Name="GraffitiesGrid" VerticalAlignment="Top" Margin="0,10,0,0" ItemHeight="90" DesiredWidth="120" StretchContentForSingleRow="False" IsItemClickEnabled="True" ItemsSource="{Binding Items}" ItemClick="OnItemClick">
                    <wct:AdaptiveGridView.ItemTemplate>
                        <DataTemplate x:DataType="vk:ConversationAttachment">
                            <Border>
                                <Border.Background>
                                    <ImageBrush Stretch="Uniform">
                                        <ImageBrush.ImageSource>
                                            <BitmapImage UriSource="{x:Bind Attachment.Graffiti.Uri}" DecodePixelType="Logical" DecodePixelHeight="120"/>
                                        </ImageBrush.ImageSource>
                                    </ImageBrush>
                                </Border.Background>
                            </Border>
                        </DataTemplate>
                    </wct:AdaptiveGridView.ItemTemplate>
                    <wct:AdaptiveGridView.Footer>
                        <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsLoading}"/>
                    </wct:AdaptiveGridView.Footer>
                </wct:AdaptiveGridView>
                <vkui:Placeholder Grid.ColumnSpan="2" VerticalAlignment="Stretch" 
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
            </Grid>
        </PivotItem>
        <!--<PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=conv_attaches_audiomessages}">
            <Grid Margin="4,0" DataContext="{Binding AudioMessages}">
                <ListView x:Name="AudioMessagesList" VerticalAlignment="Top" Margin="0,10,0,0" IsItemClickEnabled="True" ItemContainerStyle="{StaticResource VKUIListViewItemStyle}" ItemTemplate="{StaticResource AudioMessageTemplate}" ItemsSource="{Binding Items}" ItemClick="OnItemClick">
                    <ListView.Footer>
                        <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsLoading}"/>
                    </ListView.Footer>
                </ListView>
                <vkui:Placeholder
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
            </Grid>
        </PivotItem>-->
    </Pivot>
</elor:Modal>
