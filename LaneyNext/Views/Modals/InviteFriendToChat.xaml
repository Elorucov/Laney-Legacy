<elor:Modal
    x:Class="Elorucov.Laney.Views.Modals.InviteFriendToChat"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Views.Modals"
    xmlns:elor="using:Elorucov.Toolkit.UWP.Controls"
    xmlns:vkui="using:VK.VKUI.Controls"
    xmlns:vkuip="using:VK.VKUI.Popups"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d" x:Name="ModalRoot"
    Style="{ThemeResource VKUIFullModalStyle}" Title="{x:Bind Converter={StaticResource loc}, ConverterParameter=convcreator_select_friends}">

    <elor:Modal.Resources>
        <CollectionViewSource x:Name="FriendsGroups" x:Key="FriendsGroups" IsSourceGrouped="True" Source="{Binding Friends, Mode=TwoWay}"/>
    </elor:Modal.Resources>
    
    <Grid>
        <Grid Visibility="{Binding Friends, Converter={StaticResource ntv}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <SemanticZoom Grid.ColumnSpan="2">
                <SemanticZoom.ZoomedInView>
                    <ListView x:Name="FriendsList" ItemsSource="{Binding Source={StaticResource FriendsGroups}}" ItemContainerStyle="{StaticResource CommonListViewItemStyle}" ItemTemplate="{StaticResource DefaultUserItemTemplate}" SelectionMode="Multiple" SelectionChanged="FriendsList_SelectionChanged">
                        <ListView.GroupStyle>
                            <GroupStyle HidesIfEmpty="True" HeaderTemplate="{StaticResource FriendsGroupHeaderTemplate}"/>
                        </ListView.GroupStyle>
                    </ListView>
                </SemanticZoom.ZoomedInView>
                <SemanticZoom.ZoomedOutView>
                    <GridView ItemsSource="{Binding Source={StaticResource FriendsGroups}, Path=CollectionGroups}" HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="320">
                        <GridView.ItemTemplate>
                            <DataTemplate>
                                <Border Background="Transparent" Width="48" Height="48" Margin="4">
                                    <TextBlock Text="{Binding Group.SemanticZoomGlyph}"
                               FontFamily="{Binding Group.SemanticZoomGlyphFontFamily}"
                               Opacity="0.75" 
                               FontSize="24"
                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </GridView.ItemTemplate>
                    </GridView>
                </SemanticZoom.ZoomedOutView>
            </SemanticZoom>
            <TextBlock Grid.Row="1" Margin="16,0,0,16" VerticalAlignment="Bottom" Text="{Binding BottomText}"/>
            <Button Margin="16,8,16,16" Grid.Row="1" Grid.Column="1" Style="{StaticResource VKButtonPrimaryLarge}" Visibility="{Binding IsEnabled, Converter={StaticResource ntv}}" IsEnabled="{Binding SelectedFriends, Converter={StaticResource ntv}}" HorizontalAlignment="Right" Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=continue}">
                <Button.Flyout>
                    <vkuip:Flyout>
                        <vkuip:Flyout.Content>
                            <StackPanel>
                                <TextBlock FontWeight="SemiBold" Text="{x:Bind Converter={StaticResource loc}, ConverterParameter=visible_messages_count}"/>
                                <TextBox x:Name="VisibleMessagesCount" Style="{StaticResource VKTextBox}" Margin="0,12" MaxLength="4" InputScope="Digits" TextWrapping="Wrap" IsReadOnly="{Binding IsEnabled, Converter={StaticResource ntv2}}" HorizontalAlignment="Stretch" Text="0" TextChanged="VisibleMessagesCount_TextChanged"/>
                                <Button Style="{StaticResource VKButtonPrimaryMedium}" HorizontalAlignment="Stretch" IsEnabled="{Binding IsEnabled}" Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=invite}" Command="{Binding CreateCommand}" CommandParameter="{Binding ElementName=ModalRoot}"/>
                            </StackPanel>
                        </vkuip:Flyout.Content>
                    </vkuip:Flyout>
                </Button.Flyout>
            </Button>
            <vkui:Spinner Grid.Row="1" Grid.Column="1" HorizontalAlignment="Right" Foreground="{ThemeResource VKAccentBrush}" Margin="16,18" Width="32" Height="32" Visibility="{Binding IsEnabled, Converter={StaticResource ntv2}}"/>
        </Grid>
        <vkui:Placeholder VerticalAlignment="Stretch" 
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
        <vkui:Spinner HorizontalAlignment="Center" VerticalAlignment="Center" Width="44" Height="44" Foreground="{ThemeResource VKAccentBrush}" Visibility="{Binding IsLoading}"/>
    </Grid>
</elor:Modal>
