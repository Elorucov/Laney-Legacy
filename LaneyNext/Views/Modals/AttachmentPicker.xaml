<elor:Modal
    x:Class="Elorucov.Laney.Views.Modals.AttachmentPicker"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Views.Modals"
    xmlns:elor="using:Elorucov.Toolkit.UWP.Controls"
    xmlns:ctrl="using:Elorucov.Laney.Controls"
    xmlns:vkui="using:VK.VKUI.Controls"
    xmlns:wct="using:Elorucov.Laney.Controls.WinComToolkit"
    xmlns:vk="using:ELOR.VKAPILib.Objects"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Style="{StaticResource VKUITabModalStyle}">
    <elor:Modal.Resources>
        <Thickness x:Key="PivotItemMargin">16,0</Thickness>
        <DataTemplate x:Key="AlbumTemplate" x:DataType="vk:Album">
            <TextBlock Text="{x:Bind Title}"/>
        </DataTemplate>
        <DataTemplate x:Key="PhotoTemplate" x:DataType="vk:Photo">
            <ctrl:ClickableImage IsHitTestVisible="False" MaxWidth="105" Image="{x:Bind}"/>
        </DataTemplate>
        <DataTemplate x:Key="VideoTemplate" x:DataType="vk:Video">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Border Background="#7f7f7f7f" Height="92">
                    <Grid MaxWidth="228" CornerRadius="4">
                        <Grid.Background>
                            <ImageBrush Stretch="UniformToFill">
                                <ImageBrush.ImageSource>
                                    <BitmapImage UriSource="{x:Bind PreviewImageUri}" DecodePixelType="Logical" DecodePixelHeight="92"/>
                                </ImageBrush.ImageSource>
                            </ImageBrush>
                        </Grid.Background>
                        <StackPanel x:Name="VideoDurationContainer" CornerRadius="3" Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="4" Background="#7f000000" Visibility="{x:Bind DurationTime, Converter={StaticResource ntv}}">
                            <TextBlock x:Name="VideoDuration" VerticalAlignment="Center" LineHeight="17" Foreground="White" Margin="5,0" FontSize="12" Text="{x:Bind DurationTime, Converter={StaticResource dts}}"/>
                        </StackPanel>
                    </Grid>
                </Border>
                <StackPanel Grid.Row="1">
                    <TextBlock Text="{x:Bind Title}" TextTrimming="CharacterEllipsis" Foreground="{ThemeResource VKTextPrimaryBrush}"/>
                    <TextBlock Text="{x:Bind Views, Converter={StaticResource ctr}, ConverterParameter=views}" TextTrimming="CharacterEllipsis" FontSize="13" Foreground="{ThemeResource VKTextSecondaryBrush}"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="DocTemplate" x:DataType="vk:Document">
            <Grid>
                <Grid Height="48" Margin="0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <ContentControl Margin="0,0,8,0" Content="{x:Bind Converter={StaticResource dic}}"/>
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="{x:Bind Title}" TextTrimming="CharacterEllipsis" FontWeight="SemiBold" Foreground="{ThemeResource VKTextPrimaryBrush}"/>
                        <TextBlock Text="{x:Bind Size, Converter={StaticResource fzc}}" Foreground="{ThemeResource VKTextSecondaryBrush}"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </DataTemplate>
    </elor:Modal.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Pivot x:Name="ThePivot">
            <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=a_photo}">
                <Grid Margin="0,12,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <ComboBox x:Name="PhotoAlbumList" Style="{StaticResource VKComboBox}" Margin="0,0,8,0" HorizontalAlignment="Stretch" ItemTemplate="{StaticResource AlbumTemplate}" ItemsSource="{Binding PhotoAlbums}" SelectedItem="{Binding SelectedPhotoAlbum, Mode=TwoWay}"/>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Style="{StaticResource VKButtonTertiaryExtraLarge}" Padding="8" ContentTemplate="{StaticResource Icon28CameraOutline}" Click="ShowCameraCaptureWindowForPhoto"/>
                        <Button Style="{StaticResource VKButtonTertiaryExtraLarge}" Padding="8" ContentTemplate="{StaticResource Icon28UploadOutline}" Click="OpenFilePickerForPhoto"/>
                    </StackPanel>
                    <wct:AdaptiveGridView x:Name="PhotosGrid" Grid.ColumnSpan="2" Grid.Row="1" VerticalAlignment="Top" Margin="0,10,0,0" ItemHeight="70" DesiredWidth="104" StretchContentForSingleRow="False" SelectionMode="Multiple" ItemTemplate="{StaticResource PhotoTemplate}" ItemsSource="{Binding Photos}" SelectionChanged="ItemChecked" Tag="1" Loaded="RegisterIncrementalLoadingEvent">
                        <wct:AdaptiveGridView.Footer>
                            <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsPhotosLoading}"/>
                        </wct:AdaptiveGridView.Footer>
                    </wct:AdaptiveGridView>
                    <vkui:Placeholder Grid.ColumnSpan="2" Grid.Row="1" VerticalAlignment="Stretch" 
                          Visibility="{Binding PhotosPlaceholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding PhotosPlaceholder, Converter={StaticResource pic}}" 
                          Header="{Binding PhotosPlaceholder.Header}"
                          Content="{Binding PhotosPlaceholder.Content}"
                          ActionButtonText="{Binding PhotosPlaceholder.ActionButton}"
                          ActionButtonCommand="{Binding PhotosPlaceholder.ActionButtonCommand}"/>
                </Grid>
            </PivotItem>
            <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=a_video}">
                <Grid Margin="0,12,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <ComboBox x:Name="VideoAlbumList" Style="{StaticResource VKComboBox}" Margin="0,0,8,0" HorizontalAlignment="Stretch" ItemTemplate="{StaticResource AlbumTemplate}" ItemsSource="{Binding VideoAlbums}" SelectedItem="{Binding SelectedVideoAlbum, Mode=TwoWay}"/>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Style="{StaticResource VKButtonTertiaryExtraLarge}" Padding="8" ContentTemplate="{StaticResource Icon28VideocamOutline}" Click="ShowCameraCaptureWindowForVideo"/>
                        <Button Style="{StaticResource VKButtonTertiaryExtraLarge}" Padding="8" ContentTemplate="{StaticResource Icon28UploadOutline}" Click="OpenFilePickerForVideo"/>
                    </StackPanel>
                    <wct:AdaptiveGridView x:Name="VideosGrid" Grid.ColumnSpan="2" Grid.Row="1" VerticalAlignment="Top" Margin="0,10,0,0" ItemHeight="132" DesiredWidth="164" StretchContentForSingleRow="False" SelectionMode="Multiple" ItemTemplate="{StaticResource VideoTemplate}" ItemsSource="{Binding Videos}" SelectionChanged="ItemChecked" Tag="2" Loaded="RegisterIncrementalLoadingEvent">
                        <wct:AdaptiveGridView.Footer>
                            <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsVideosLoading}"/>
                        </wct:AdaptiveGridView.Footer>
                    </wct:AdaptiveGridView>
                    <vkui:Placeholder Grid.ColumnSpan="2" Grid.Row="1" VerticalAlignment="Stretch" 
                          Visibility="{Binding VideosPlaceholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding VideosPlaceholder, Converter={StaticResource pic}}" 
                          Header="{Binding VideosPlaceholder.Header}"
                          Content="{Binding VideosPlaceholder.Content}"
                          ActionButtonText="{Binding VideosPlaceholder.ActionButton}"
                          ActionButtonCommand="{Binding VideosPlaceholder.ActionButtonCommand}"/>
                </Grid>
            </PivotItem>
            <PivotItem Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=a_doc}">
                <Grid Margin="0,12,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <ComboBox x:Name="DocsTypeList" Style="{StaticResource VKComboBox}" Margin="0,0,8,0" HorizontalAlignment="Stretch" SelectedIndex="{Binding DocumentTypeIndex, Mode=TwoWay}">
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_all}"/>
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_texts}"/>
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_archives}"/>
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_animations}"/>
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_pictures}"/>
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_audio}"/>
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_video}"/>
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_books}"/>
                        <ComboBoxItem Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=atchpicker_doctype_other}"/>
                    </ComboBox>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Style="{StaticResource VKButtonTertiaryExtraLarge}" Padding="8" ContentTemplate="{StaticResource Icon28UploadOutline}" Click="OpenFilePickerForDocs"/>
                    </StackPanel>
                    <ListView x:Name="DocsList" Grid.ColumnSpan="2" Grid.Row="1" VerticalAlignment="Top" Margin="0,10,0,0" SelectionMode="Multiple" ItemContainerStyle="{StaticResource VKUIListViewItemStyle}" ItemTemplate="{StaticResource DocTemplate}" ItemsSource="{Binding Documents}" SelectionChanged="ItemChecked" Tag="3" Loaded="RegisterIncrementalLoadingEvent">
                        <ListView.Footer>
                            <vkui:Spinner Width="24" Height="24" Margin="12" HorizontalAlignment="Center" Visibility="{Binding IsDocsLoading}"/>
                        </ListView.Footer>
                    </ListView>
                    <vkui:Placeholder Grid.ColumnSpan="2" Grid.Row="1" VerticalAlignment="Stretch" 
                          Visibility="{Binding DocsPlaceholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding DocsPlaceholder, Converter={StaticResource pic}}" 
                          Header="{Binding DocsPlaceholder.Header}"
                          Content="{Binding DocsPlaceholder.Content}"
                          ActionButtonText="{Binding DocsPlaceholder.ActionButton}"
                          ActionButtonCommand="{Binding DocsPlaceholder.ActionButtonCommand}"/>
                </Grid>
            </PivotItem>
        </Pivot>
        <Button Grid.Row="1" Margin="16" Style="{StaticResource VKButtonPrimaryExtraLarge}" HorizontalAlignment="Stretch" Click="AttachAndClose">
            <TextBlock>
                <Run Text="{x:Bind Converter={StaticResource loc}, ConverterParameter=attach}"/>
                (<Run Text="{Binding SelectedAttachmentsCount}"/>)
            </TextBlock>
        </Button>
    </Grid>
</elor:Modal>
