<local:SettingsPageBase
    x:Class="Elorucov.Laney.Views.Settings.Privacy"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Views.Settings"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vkui="using:VK.VKUI.Controls"
    xmlns:vkobj="using:ELOR.VKAPILib.Objects"
    xmlns:dts="using:Elorucov.Laney.Helpers.DataTemplateSelectors"
    mc:Ignorable="d">

    <local:SettingsPageBase.Resources>
        <CollectionViewSource x:Name="SettingsGroups" x:Key="SettingsGroups" IsSourceGrouped="True" Source="{Binding GroupedSettings, Mode=TwoWay}"/>

        <DataTemplate x:Key="ListTemplate" x:DataType="vkobj:PrivacySetting">
            <ComboBox Margin="16,0,16,16" HorizontalAlignment="Stretch" Style="{StaticResource VKComboBox}" ItemsSource="{x:Bind SupportedCategories}" SelectedItem="{x:Bind Value.Category}" Loaded="ComboBox_Loaded">
                <ComboBox.Header>
                    <TextBlock Style="{StaticResource VKText}" TextWrapping="Wrap" FontWeight="SemiBold" Text="{x:Bind Title}"/>
                </ComboBox.Header>
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Converter={StaticResource vpc}}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
        </DataTemplate>
        <DataTemplate x:Key="BinaryTemplate" x:DataType="vkobj:PrivacySetting">
            <Grid Margin="16,0,16,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Style="{StaticResource VKText}" VerticalAlignment="Center" FontWeight="SemiBold" Text="{x:Bind Title}"/>
                <ToggleSwitch Grid.Column="1" Style="{StaticResource CellButtonToggleIndicatorStyle}" IsHitTestVisible="True" Margin="16,0,0,0" IsOn="{x:Bind Value.IsEnabled}" Loaded="ToggleSwitch_Loaded"/>
            </Grid>
        </DataTemplate>
        <dts:VKPrivacyDTSelector x:Key="PrivacyDTS" Binary="{StaticResource BinaryTemplate}" List="{StaticResource ListTemplate}"/>
    </local:SettingsPageBase.Resources>

    <Grid>
        <ListView ItemsSource="{Binding Source={StaticResource SettingsGroups}}" ItemContainerStyle="{StaticResource CommonListViewItemStyle}" ItemTemplateSelector="{StaticResource PrivacyDTS}" SelectionMode="None">
            <ListView.Header>
                <vkui:Group Header="{x:Bind Converter={StaticResource loc}, ConverterParameter=pass_modal_creation}" Margin="16,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Button Style="{StaticResource VKButtonSecondaryMedium}" Margin="0,0,8,0" Visibility="{Binding HaveLocalPassword, Converter={StaticResource ntv2}}" Command="{Binding SetOrChangePasswordCommand}" Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=set}"/>
                            <Button Style="{StaticResource VKButtonSecondaryMedium}" Margin="0,0,8,0" Visibility="{Binding HaveLocalPassword}" Command="{Binding SetOrChangePasswordCommand}" Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=change}"/>
                            <Button Style="{StaticResource VKButtonSecondaryMedium}" Margin="0,0,8,0" Visibility="{Binding HaveLocalPassword}" Command="{Binding DeletePasswordCommand}" Content="{x:Bind Converter={StaticResource loc}, ConverterParameter=delete}"/>
                        </StackPanel>
                        <vkui:CellButton Padding="0" Visibility="{Binding HaveLocalPassword}" IsEnabled="{Binding WindowsHelloReady}" Command="{Binding ToggleWinHelloCommand}" Text="{x:Bind Converter={StaticResource loc}, ConverterParameter=st_privacy_winhello}">
                            <vkui:CellButton.Indicator>
                                <ToggleSwitch x:Name="ts1" IsHitTestVisible="False" IsOn="{Binding WindowsHelloEnabled, Mode=OneWay}"/>
                            </vkui:CellButton.Indicator>
                        </vkui:CellButton>
                    </StackPanel>
                </vkui:Group>
            </ListView.Header>
            <ListView.GroupStyle>
                <GroupStyle HidesIfEmpty="True" HeaderTemplate="{StaticResource GroupHeaderWithIconTemplate}"/>
            </ListView.GroupStyle>
            <ListView.Clip>
                <RectangleGeometry Rect="0,1,9999,9999"/>
            </ListView.Clip>
        </ListView>
        <vkui:Placeholder VerticalAlignment="Stretch" 
                          Visibility="{Binding Placeholder, Converter={StaticResource ntv}}"
                          IconTemplate="{Binding Placeholder, Converter={StaticResource pic}}" 
                          Header="{Binding Placeholder.Header}"
                          Content="{Binding Placeholder.Content}"
                          ActionButtonText="{Binding Placeholder.ActionButton}"
                          ActionButtonCommand="{Binding Placeholder.ActionButtonCommand}"/>
        <vkui:Spinner HorizontalAlignment="Center" VerticalAlignment="Center" Width="44" Height="44" Foreground="{ThemeResource VKAccentBrush}" Visibility="{Binding IsLoading}"/>
    </Grid>
</local:SettingsPageBase>