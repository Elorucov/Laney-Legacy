<Page x:Name="Root"
    x:Class="Elorucov.Laney.Views.PhotoViewer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Views"
    xmlns:elor="using:Elorucov.Toolkit.UWP.Controls"
    xmlns:vkui="using:VK.VKUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Black" RequestedTheme="Dark" Loaded="OnLoaded">

    <Grid>
        <FlipView x:Name="MainFlipView" Background="Transparent" ItemsSource="{Binding Images}" SelectedItem="{Binding CurrentImage, Mode=TwoWay}" SelectionChanged="FlipView_SelectionChanged" Tapped="MainFlipView_Tapped" FocusVisualMargin="0">
            <FlipView.ItemTemplate>
                <DataTemplate>
                    <Grid>
                        <vkui:Spinner HorizontalAlignment="Center" VerticalAlignment="Center" Width="44" Height="44"/>
                        <ScrollViewer 
                Name="ScrollViewerMain"
                HorizontalScrollBarVisibility="Auto"
                VerticalScrollBarVisibility="Auto"
                MinZoomFactor="1" 
                ZoomMode="Enabled" DoubleTapped="ZoomImage">
                            <Image
                    MaxWidth="{Binding Path=ViewportWidth, ElementName=ScrollViewerMain}"
                    MaxHeight="{Binding Path=ViewportHeight, ElementName=ScrollViewerMain}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Source="{Binding Path}"/>
                        </ScrollViewer>
                    </Grid>
                </DataTemplate>
            </FlipView.ItemTemplate>
        </FlipView>
        <Border x:Name="Top" Height="48" VerticalAlignment="Top">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <LinearGradientBrush.GradientStops>
                        <GradientStop Offset="0" Color="#7f000000"/>
                        <GradientStop Offset="1" Color="#00000000"/>
                    </LinearGradientBrush.GradientStops>
                </LinearGradientBrush>
            </Border.Background>
            <TextBlock HorizontalAlignment="Center" TextAlignment="Center" Margin="6" FontWeight="SemiBold">
                <Run x:Name="CurrentIndex"/>
                <Run Text="/"/>
                <Run Text="{Binding Images.Count}"/>
            </TextBlock>
        </Border>
        <StackPanel x:Name="Bottom" VerticalAlignment="Bottom" DataContext="{Binding SelectedItem, ElementName=MainFlipView}">
            <StackPanel.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <LinearGradientBrush.GradientStops>
                        <GradientStop Offset="1" Color="#7f000000"/>
                        <GradientStop Offset="0" Color="#00000000"/>
                    </LinearGradientBrush.GradientStops>
                </LinearGradientBrush>
            </StackPanel.Background>
            <TextBlock x:Name="Desc" Margin="12,36,12,0" Text="{Binding Description}" Visibility="{Binding Description, Converter={StaticResource ntv}}"/>
            <Grid Margin="12" Height="52">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <elor:Avatar Margin="0,2,12,2" Width="48" Height="48" DisplayName="{Binding OwnerName}" ImageUri="{Binding OwnerAvatar}"/>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock x:Name="OwnerName" FontSize="16" FontWeight="SemiBold" Text="{Binding OwnerName}"/>
                    <TextBlock x:Name="PhotoPublishedTime" FontSize="14" Opacity="0.5" Text="{Binding PublishTime}"/>
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal" DataContext="{Binding DataContext, ElementName=Root}">
                    <Button Style="{StaticResource TitleBarVKUIButtonStyle}" ContentTemplate="{StaticResource Icon28ShareOutline}" Command="{Binding ShareCommand}" ToolTipService.ToolTip="{x:Bind Converter={StaticResource loc}, ConverterParameter=share}"/>
                    <Button Style="{StaticResource TitleBarVKUIButtonStyle}" ContentTemplate="{StaticResource Icon28ListAddOutline}" Command="{Binding SaveToCommand}" ToolTipService.ToolTip="{Binding SaveToCommandName}"/>
                    <Button Style="{StaticResource TitleBarVKUIButtonStyle}" ContentTemplate="{StaticResource Icon28DownloadOutline}" Command="{Binding DownloadCommand}" ToolTipService.ToolTip="{x:Bind Converter={StaticResource loc}, ConverterParameter=download}"/>
                </StackPanel>
            </Grid>
        </StackPanel>
    </Grid>
</Page>
