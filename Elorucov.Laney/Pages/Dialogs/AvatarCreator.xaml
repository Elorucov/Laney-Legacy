<elor:Modal
    x:Class="Elorucov.Laney.Pages.Dialogs.AvatarCreator"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Pages.Dialogs"
    xmlns:elor="using:Elorucov.Toolkit.UWP.Controls"
    xmlns:wuxdata="using:Windows.UI.Xaml.Data"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:data="using:Elorucov.Laney.Models"
    xmlns:lc="using:Elorucov.Laney.Controls"
    xmlns:acdata="using:Elorucov.Laney.Models.AvatarCreator"
    xmlns:converters="using:Elorucov.Laney.Services.Converters.MessageItem"
    xmlns:win1809="http://schemas.microsoft.com/winfx/2006/xaml/presentation?IsApiContractPresent(Windows.Foundation.UniversalApiContract, 7)"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d" Style="{StaticResource ContentUnderTitleBarModalStyle}"
    SizeChanged="OnRootSizeChanged" Loaded="OnLoaded" FullSizeDesired="True" MaxWidth="720" MaxHeight="640">

    <elor:Modal.Resources>        
        <converters:NullToVisibility2 x:Key="ibtv"/>
        <CollectionViewSource x:Name="GroupedEmojisCVS" Source="{Binding GroupedEmojis, Mode=OneWay}" IsSourceGrouped="True" ItemsPath="Items"/>
        <CollectionViewSource x:Name="StickerPacksCVS" Source="{Binding StickerPacks, Mode=OneWay}" IsSourceGrouped="True" ItemsPath="Items"/>
        <CollectionViewSource x:Name="GroupedKaomojiCVS" Source="{Binding KaomojiList, Mode=OneWay}" IsSourceGrouped="True" ItemsPath="Items"/>

        <!-- GridView's Group Header -->
        <Style TargetType="GridViewHeaderItem">
            <Setter Property="FontFamily" Value="{ThemeResource ContentControlThemeFontFamily}" />
            <Setter Property="FontSize" Value="{ThemeResource GridViewHeaderItemThemeFontSize}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="UseSystemFocusVisuals" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GridViewHeaderItem">
                        <StackPanel Background="{TemplateBinding Background}"
                  BorderBrush="{TemplateBinding BorderBrush}"
                  BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter x:Name="ContentPresenter"
                          Margin="{TemplateBinding Padding}"
                          Content="{TemplateBinding Content}"
                          ContentTemplate="{TemplateBinding ContentTemplate}"
                          ContentTransitions="{TemplateBinding ContentTransitions}"
                          HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                          VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </StackPanel>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <win1809:Style x:Key="LeftSideButtonStyle" TargetType="Button">
            <Setter Property="CornerRadius" Value="4,0,0,4"/>
        </win1809:Style>
        <win1809:Style x:Key="RightSideButtonStyle" TargetType="Button">
            <Setter Property="BorderThickness" Value="0,1,1,1"/>
            <Setter Property="CornerRadius" Value="0,4,4,0"/>
        </win1809:Style>

        <win1809:Style x:Key="LeftSideToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="BorderThickness" Value="1,1,0,1"/>
            <Setter Property="CornerRadius" Value="4,0,0,4"/>
        </win1809:Style>
        <win1809:Style x:Key="RightSideToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="BorderThickness" Value="0,1,1,1"/>
            <Setter Property="CornerRadius" Value="0,4,4,0"/>
        </win1809:Style>
        <win1809:Style x:Key="MiddleToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="CornerRadius" Value="0"/>
        </win1809:Style>
    </elor:Modal.Resources>

    <Grid x:Name="rootGrid">
        <muxc:ProgressRing HorizontalAlignment="Center" VerticalAlignment="Center" Width="64" Height="64" IsIndeterminate="{Binding IsIndeterminate}" Value="{Binding LoadingProgress}" Maximum="100" Visibility="{Binding IsReady, Converter={StaticResource ibtv}}"/>
        <SplitView x:Name="splitView" Visibility="{Binding IsReady}" PanePlacement="Right" DisplayMode="Inline" OpenPaneLength="400" IsPaneOpen="True">
            <SplitView.Content>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition />
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Viewbox Width="256" Height="256" VerticalAlignment="Top" Margin="0,16,0,6">
                        <Canvas x:Name="canvas" Width="320" Height="320">
                            <Canvas x:Name="workCanvas" Width="320" Height="320">
                                <Rectangle Width="320" Height="320">
                                    <Rectangle.Fill>
                                        <LinearGradientBrush x:Name="gradientBrush" StartPoint="0,0" EndPoint="1,1">
                                            <LinearGradientBrush.GradientStops>
                                                <GradientStop Color="{Binding GradientStartColor}" Offset="0"/>
                                                <GradientStop Color="{Binding GradientEndColor}" Offset="1"/>
                                            </LinearGradientBrush.GradientStops>
                                        </LinearGradientBrush>
                                    </Rectangle.Fill>
                                </Rectangle>
                                <Viewbox x:Name="WaterMark" Stretch="Uniform" Width="20" Height="20" Canvas.Left="10" Canvas.Top="10" RequestedTheme="Dark">
                                    <ContentPresenter ContentTemplate="{StaticResource LogoTemplate}" Opacity="0.1"/>
                                </Viewbox>
                                <!-- Placeholder, removed and replaced by emoji or something in code-behind -->
                                <Rectangle/>
                            </Canvas>
                            <Path x:Name="avaMask" Width="320" Height="320" Fill="{ThemeResource SolidBackgroundFillColorBaseBrush}" Data="M 0 0 L 0 160 A 160 160 0 0 1 160 0 L 0 0 z M 160 0 A 160 160 0 0 1 320 160 L 320 0 L 160 0 z M 320 160 A 160 160 0 0 1 160 320 L 320 320 L 320 160 z M 160 320 A 160 160 0 0 1 0 160 L 0 320 L 160 320 z"/>
                        </Canvas>
                    </Viewbox>

                    <StackPanel Grid.Row="1" Margin="26,6">
                        <Grid x:Name="gradientPresets" Margin="6,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <muxc:ItemsRepeaterScrollHost Grid.Column="1">
                                <ScrollViewer x:Name="gradientsPresetScrollViewer" VerticalScrollMode="Disabled" IsVerticalRailEnabled="False" HorizontalScrollMode="Enabled" IsHorizontalRailEnabled="True" HorizontalScrollBarVisibility="Hidden">
                                    <muxc:ItemsRepeater Margin="4,0" ItemsSource="{Binding GradientPresets}">
                                        <muxc:ItemsRepeater.Layout>
                                            <muxc:StackLayout Orientation="Horizontal"/>
                                        </muxc:ItemsRepeater.Layout>
                                        <muxc:ItemsRepeater.ItemTemplate>
                                            <DataTemplate x:DataType="acdata:GradientPreset">
                                                <HyperlinkButton Tag="{x:Bind}" Width="32" Height="24" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Click="SetGradient">
                                                    <Ellipse Width="22" Height="22" StrokeThickness="1" Stroke="#1f000000">
                                                        <Ellipse.Fill>
                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                <LinearGradientBrush.GradientStops>
                                                                    <GradientStop Offset="0" Color="{x:Bind StartColor}"/>
                                                                    <GradientStop Offset="1" Color="{x:Bind EndColor}"/>
                                                                </LinearGradientBrush.GradientStops>
                                                            </LinearGradientBrush>
                                                        </Ellipse.Fill>
                                                    </Ellipse>
                                                </HyperlinkButton>
                                            </DataTemplate>
                                        </muxc:ItemsRepeater.ItemTemplate>
                                    </muxc:ItemsRepeater>
                                </ScrollViewer>
                            </muxc:ItemsRepeaterScrollHost>
                            <Button Grid.Column="0" Padding="4" Click="ScrollGPLLeft">
                                <lc:FixedFontIcon Glyph=""/>
                            </Button>
                            <Button Grid.Column="2" Padding="4" Click="ScrollGPLRight">
                                <lc:FixedFontIcon Glyph=""/>
                            </Button>
                        </Grid>
                        <Grid x:Name="gradientsTools" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="startGradBtn" win1809:Style="{StaticResource LeftSideButtonStyle}" HorizontalContentAlignment="Stretch" HorizontalAlignment="Stretch" Margin="6,6,0,6" Padding="0">
                                <Button.Flyout>
                                    <Flyout win1809:ShouldConstrainToRootBounds="False">
                                        <muxc:ColorPicker Margin="12" Color="{Binding GradientStartColor, Mode=TwoWay}" ColorSpectrumShape="Ring" IsColorSliderVisible="True" IsColorChannelTextInputVisible="True" IsHexInputVisible="True"/>
                                    </Flyout>
                                </Button.Flyout>
                                <Border Height="16" Margin="8" BorderThickness="1" BorderBrush="#1F000000">
                                    <Border.Background>
                                        <SolidColorBrush Color="{Binding GradientStartColor}"/>
                                    </Border.Background>
                                </Border>
                            </Button>
                            <Button x:Name="endGradBtn" win1809:Style="{StaticResource RightSideButtonStyle}" HorizontalContentAlignment="Stretch" HorizontalAlignment="Stretch" Margin="0,6,6,6" Padding="0" Grid.Column="1">
                                <Button.Flyout>
                                    <Flyout win1809:ShouldConstrainToRootBounds="False">
                                        <muxc:ColorPicker Margin="12" Color="{Binding GradientEndColor, Mode=TwoWay}" ColorSpectrumShape="Ring" IsColorSliderVisible="True" IsColorChannelTextInputVisible="True" IsHexInputVisible="True"/>
                                    </Flyout>
                                </Button.Flyout>
                                <Border Height="16" Margin="8" BorderThickness="1" BorderBrush="#1F000000">
                                    <Border.Background>
                                        <SolidColorBrush Color="{Binding GradientEndColor}"/>
                                    </Border.Background>
                                </Border>
                            </Button>
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,6,6,6">
                                <ToggleButton x:Name="directionLTRBtn" win1809:Style="{StaticResource LeftSideToggleButtonStyle}" Padding="8,7" IsChecked="True" Click="ChangeGradientDirectionToLTR">
                                    <lc:FixedFontIcon Glyph=""/>
                                </ToggleButton>
                                <ToggleButton x:Name="directionTTBBtn" win1809:Style="{StaticResource MiddleToggleButtonStyle}" Padding="8,7" Click="ChangeGradientDirectionToTTB">
                                    <lc:FixedFontIcon Glyph=""/>
                                </ToggleButton>
                                <ToggleButton x:Name="directionRTLBtn" win1809:Style="{StaticResource RightSideToggleButtonStyle}" Padding="8,7" Click="ChangeGradientDirectionToRTL">
                                    <lc:FixedFontIcon Glyph="">
                                        <FontIcon.RenderTransform>
                                            <ScaleTransform ScaleX="-1" CenterX="8"/>
                                        </FontIcon.RenderTransform>
                                    </lc:FixedFontIcon>
                                </ToggleButton>
                            </StackPanel>
                        </Grid>
                        <Grid x:Name="kaomojiTools" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="56"/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <TextBlock Margin="6,0" Style="{StaticResource CaptionTextBlockStyle}" FontWeight="SemiBold" VerticalAlignment="Center" x:Uid="size"/>
                            <Slider x:Name="kaomojiSize" Grid.Column="1" Margin="6,0" Minimum="32" Maximum="72" Value="{Binding KaomojiSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" ValueChanged="ResizeKaomoji"/>
                            <TextBlock Grid.Row="1" Margin="6,0" Style="{StaticResource CaptionTextBlockStyle}" FontWeight="SemiBold" VerticalAlignment="Center" x:Uid="color"/>
                            <Button Grid.Row="1" Grid.Column="1" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" Margin="6,0" Padding="0">
                                <Button.Flyout>
                                    <Flyout win1809:ShouldConstrainToRootBounds="False">
                                        <muxc:ColorPicker Margin="12" Color="{Binding KaomojiColor, Mode=TwoWay}" ColorSpectrumShape="Ring" IsColorSliderVisible="True" IsColorChannelTextInputVisible="True" IsHexInputVisible="True" ColorChanged="ChangeKaomojiColor"/>
                                    </Flyout>
                                </Button.Flyout>
                                <Border Height="16" Margin="8" BorderThickness="1" BorderBrush="#1F000000">
                                    <Border.Background>
                                        <SolidColorBrush Color="{Binding KaomojiColor}"/>
                                    </Border.Background>
                                </Border>
                            </Button>
                        </Grid>
                        <StackPanel x:Name="stickerTools" Visibility="Collapsed">
                            <CheckBox x:Name="stickerBorder" x:Uid="sticker_border" Margin="6,6,0,0" Checked="stickerBorder_Checked" Unchecked="stickerBorder_Checked"/>
                        </StackPanel>
                    </StackPanel>
                    <Grid Grid.Row="2" Margin="29,9,29,29">
                        <Grid.Resources>
                            <Style TargetType="TextBlock">
                                <Setter Property="Margin" Value="4,0"/>
                                <Setter Property="FontSize" Value="12"/>
                                <Setter Property="LineHeight" Value="14"/>
                                <Setter Property="TextWrapping" Value="Wrap"/>
                                <Setter Property="LineStackingStrategy" Value="BlockLineHeight"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                            <Style TargetType="lc:FixedFontIcon">
                                <Setter Property="Margin" Value="4,2"/>
                            </Style>
                        </Grid.Resources>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <Button x:Name="randomBtn" Margin="3" Padding="4" MinHeight="32" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Click="GenerateRandomAvatar">
                            <RelativePanel>
                                <lc:FixedFontIcon x:Name="bfi1" RelativePanel.AlignVerticalCenterWithPanel="True" Glyph="" VerticalAlignment="Center"/>
                                <TextBlock x:Name="btb1" RelativePanel.RightOf="bfi1" RelativePanel.AlignVerticalCenterWith="bfi1" x:Uid="avacreator_randomize"/>
                            </RelativePanel>
                        </Button>
                        <Button x:Name="chooseBtn" Margin="3" Padding="4" MinHeight="32" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Grid.Column="1" Click="OpenRightPanel">
                            <RelativePanel>
                                <lc:FixedFontIcon x:Name="bfi2" RelativePanel.AlignVerticalCenterWithPanel="True" Glyph="" VerticalAlignment="Center"/>
                                <TextBlock x:Name="btb2" RelativePanel.RightOf="bfi2" RelativePanel.AlignVerticalCenterWith="bfi2" x:Uid="avacreator_choose"/>
                            </RelativePanel>
                        </Button>
                        <Button x:Name="saveBtn" Margin="3" Padding="4" MinHeight="32" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Grid.Row="1" Click="SaveAvatar">
                            <RelativePanel>
                                <lc:FixedFontIcon x:Name="bfi3" RelativePanel.AlignVerticalCenterWithPanel="True" Glyph="" VerticalAlignment="Center"/>
                                <TextBlock x:Name="btb3" RelativePanel.RightOf="bfi3" RelativePanel.AlignVerticalCenterWith="bfi3" x:Uid="avacreator_save"/>
                            </RelativePanel>
                        </Button>
                        <Button x:Name="setBtn" Margin="3" Padding="4" MinHeight="32" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Grid.Row="1" Grid.Column="1" Style="{StaticResource AccentButtonStyle}" Visibility="Collapsed" Click="SaveAndClose">
                            <RelativePanel>
                                <lc:FixedFontIcon x:Name="bfi4" RelativePanel.AlignVerticalCenterWithPanel="True" Glyph="" VerticalAlignment="Center"/>
                                <TextBlock x:Name="btb4" RelativePanel.RightOf="bfi4" RelativePanel.AlignVerticalCenterWith="bfi4" x:Uid="avacreator_set_chat_photo"/>
                            </RelativePanel>
                        </Button>
                    </Grid>
                    <Rectangle x:Name="paneSeparator" HorizontalAlignment="Right" Grid.RowSpan="3" Width="1" Fill="{ThemeResource CardStrokeColorDefaultBrush}"/>
                </Grid>
            </SplitView.Content>
            <SplitView.Pane>
                <Grid x:Name="paneRoot" Margin="0,0,-1,0" Background="{ThemeResource SolidBackgroundFillColorQuarternaryBrush}">
                    <Pivot x:Name="panePivot">
                        <Pivot.LeftHeader>
                            <HyperlinkButton x:Name="paneCloseBtn" Width="40" Height="40" Margin="4,4,-4,4" Padding="0" Foreground="{ThemeResource ApplicationForegroundThemeBrush}" Click="CloseRightPanel">
                                <lc:FixedFontIcon FontSize="16" Glyph=""/>
                            </HyperlinkButton>
                        </Pivot.LeftHeader>
                        <Pivot.RightHeader>
                            <Border Width="48" Height="48"/>
                        </Pivot.RightHeader>
                        <PivotItem x:Uid="avacreator_tab_emoji">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <Grid x:Name="emojiTools">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>
                                    <Button Width="32" Height="32" Margin="8" Padding="0">
                                        <Button.Flyout>
                                            <Flyout Placement="Top">
                                                <ListView Margin="8" MaxWidth="216" ItemsSource="{Binding EmojiSkinTones}" SelectedItem="{Binding EmojiCurrentSkinTone, Mode=TwoWay}" ScrollViewer.VerticalScrollMode="Disabled" ScrollViewer.HorizontalScrollMode="Enabled" ScrollViewer.IsHorizontalRailEnabled="True">
                                                    <ListView.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <StackPanel Orientation="Horizontal"/>
                                                        </ItemsPanelTemplate>
                                                    </ListView.ItemsPanel>
                                                    <ListView.ItemContainerStyle>
                                                        <Style TargetType="ListViewItem">
                                                            <Setter Property="Margin" Value="0"/>
                                                            <Setter Property="Padding" Value="0"/>
                                                            <Setter Property="MinWidth" Value="32"/>
                                                            <Setter Property="MinHeight" Value="32"/>
                                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                                        </Style>
                                                    </ListView.ItemContainerStyle>
                                                    <ListView.ItemTemplate>
                                                        <DataTemplate x:DataType="data:EmojiSkinTone">
                                                            <Border Width="32" Height="32" Background="Transparent" ToolTipService.ToolTip="{x:Bind Name}">
                                                                <Ellipse Width="22" Height="22" StrokeThickness="1" Stroke="#1f000000">
                                                                    <Ellipse.Fill>
                                                                        <SolidColorBrush Color="{x:Bind Color}"/>
                                                                    </Ellipse.Fill>
                                                                </Ellipse>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ListView.ItemTemplate>
                                                </ListView>
                                            </Flyout>
                                        </Button.Flyout>
                                        <Ellipse Width="22" Height="22" StrokeThickness="1" Stroke="#1f000000">
                                            <Ellipse.Fill>
                                                <SolidColorBrush Color="{Binding EmojiCurrentSkinTone.Color}"/>
                                            </Ellipse.Fill>
                                        </Ellipse>
                                    </Button>
                                    <AutoSuggestBox Grid.Column="1" VerticalAlignment="Center" Margin="0,0,12,0" QueryIcon="Find" Text="{Binding EmojiSearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" x:Uid="avacreator_emoji_find"/>
                                </Grid>
                                <SemanticZoom Grid.Row="1">
                                    <SemanticZoom.ZoomedInView>
                                        <GridView ItemsSource="{x:Bind GroupedEmojisCVS.View, Mode=OneWay}" SelectedItem="{Binding SelectedEmoji, Mode=TwoWay}" Margin="6,0" ShowsScrollingPlaceholders="False" SelectionChanged="DrawACIInCanvas" IsItemClickEnabled="True" ItemClick="ListViewItemClicked">
                                            <GridView.ItemContainerStyle>
                                                <Style TargetType="GridViewItem">
                                                    <Setter Property="MinWidth" Value="32"/>
                                                    <Setter Property="MinHeight" Value="32"/>
                                                    <Setter Property="Margin" Value="2,0,0,2"/>
                                                    <Setter Property="Padding" Value="4"/>
                                                </Style>
                                            </GridView.ItemContainerStyle>
                                            <GridView.GroupStyle>
                                                <GroupStyle HidesIfEmpty="True">
                                                    <GroupStyle.HeaderTemplate>
                                                        <DataTemplate x:DataType="acdata:AvatarCreatorItemCollection">
                                                            <Border Height="32">
                                                                <TextBlock Margin="6,0,6,4" VerticalAlignment="Bottom" Text="{Binding Name}" Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}" Style="{StaticResource CaptionTextBlockStyle}" FontWeight="SemiBold"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </GroupStyle.HeaderTemplate>
                                                </GroupStyle>
                                            </GridView.GroupStyle>
                                            <GridView.ItemTemplate>
                                                <DataTemplate x:DataType="data:Emoji">
                                                    <Border Width="32" Height="32" DataContextChanged="DrawACIInGVI"/>
                                                </DataTemplate>
                                            </GridView.ItemTemplate>
                                        </GridView>
                                    </SemanticZoom.ZoomedInView>
                                    <SemanticZoom.ZoomedOutView>
                                        <ListView ItemsSource="{x:Bind GroupedEmojisCVS.View.CollectionGroups, Mode=OneWay}">
                                            <ListView.ItemTemplate>
                                                <DataTemplate x:DataType="wuxdata:ICollectionViewGroup">
                                                    <TextBlock Text="{x:Bind ((acdata:AvatarCreatorItemCollection)Group).Name}"/>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>
                                    </SemanticZoom.ZoomedOutView>
                                </SemanticZoom>
                            </Grid>
                        </PivotItem>
                        <PivotItem x:Uid="avacreator_tab_stickers">
                            <Grid Loaded="StickersPivotItemLoaded">
                                <SemanticZoom Visibility="{Binding IsStickerPacksLoading, Converter={StaticResource ibtv}}">
                                    <SemanticZoom.ZoomedInView>
                                        <GridView ItemsSource="{x:Bind StickerPacksCVS.View, Mode=OneWay}" SelectedItem="{Binding SelectedSticker, Mode=TwoWay}" Margin="6,0" ShowsScrollingPlaceholders="False" SelectionChanged="DrawACIInCanvas" IsItemClickEnabled="True" ItemClick="ListViewItemClicked">
                                            <GridView.ItemContainerStyle>
                                                <Style TargetType="GridViewItem">
                                                    <Setter Property="MinWidth" Value="64"/>
                                                    <Setter Property="MinHeight" Value="64"/>
                                                    <Setter Property="Margin" Value="2,0,0,2"/>
                                                    <Setter Property="Padding" Value="4"/>
                                                </Style>
                                            </GridView.ItemContainerStyle>
                                            <GridView.GroupStyle>
                                                <GroupStyle HidesIfEmpty="True">
                                                    <GroupStyle.HeaderTemplate>
                                                        <DataTemplate x:DataType="acdata:AvatarCreatorItemCollection">
                                                            <Border Height="32">
                                                                <TextBlock Margin="6,0,6,4" VerticalAlignment="Bottom" Text="{Binding Name}" Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}" Style="{StaticResource CaptionTextBlockStyle}" FontWeight="SemiBold"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </GroupStyle.HeaderTemplate>
                                                </GroupStyle>
                                            </GridView.GroupStyle>
                                            <GridView.ItemTemplate>
                                                <DataTemplate x:DataType="acdata:VKSticker">
                                                    <Border Width="64" Height="64" DataContextChanged="DrawACIInGVI"/>
                                                </DataTemplate>
                                            </GridView.ItemTemplate>
                                        </GridView>
                                    </SemanticZoom.ZoomedInView>
                                    <SemanticZoom.ZoomedOutView>
                                        <ListView ItemsSource="{x:Bind StickerPacksCVS.View.CollectionGroups, Mode=OneWay}">
                                            <ListView.ItemTemplate>
                                                <DataTemplate x:DataType="wuxdata:ICollectionViewGroup">
                                                    <RelativePanel>
                                                        <Image x:Name="spImage" Margin="0,6,12,6" RelativePanel.AlignVerticalCenterWithPanel="True" VerticalAlignment="Center" Width="48" Height="48">
                                                            <Image.Source>
                                                                <BitmapImage DecodePixelType="Logical" DecodePixelWidth="48" DecodePixelHeight="48" UriSource="{x:Bind ((acdata:AvatarCreatorItemCollection)Group).PreviewImageUri}"/>
                                                            </Image.Source>
                                                        </Image>
                                                        <TextBlock RelativePanel.RightOf="spImage" RelativePanel.AlignVerticalCenterWith="spImage" Text="{x:Bind ((acdata:AvatarCreatorItemCollection)Group).Name}"/>
                                                    </RelativePanel>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>
                                    </SemanticZoom.ZoomedOutView>
                                </SemanticZoom>
                                <muxc:ProgressRing Width="64" Height="64" IsIndeterminate="True" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding IsStickerPacksLoading}"/>
                            </Grid>
                        </PivotItem>
                        <PivotItem x:Uid="avacreator_tab_kaomoji">
                            <muxc:ItemsRepeaterScrollHost>
                                <ScrollViewer Loaded="KaomojiPivotItemLoaded">
                                    <muxc:ItemsRepeater ItemsSource="{Binding KaomojiList, Mode=OneWay}" Margin="0,0,4,16">
                                        <muxc:ItemsRepeater.Layout>
                                            <muxc:StackLayout/>
                                        </muxc:ItemsRepeater.Layout>
                                        <muxc:ItemsRepeater.ItemTemplate>
                                            <DataTemplate x:DataType="acdata:AvatarCreatorItemCollection">
                                                <StackPanel Margin="12,0,8,0">
                                                    <Border Height="32">
                                                        <TextBlock Margin="0,0,4,4" VerticalAlignment="Bottom" Text="{x:Bind Name}" Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}" Style="{StaticResource CaptionTextBlockStyle}" FontWeight="SemiBold"/>
                                                    </Border>
                                                    <muxc:ItemsRepeater ItemsSource="{x:Bind Items}">
                                                        <muxc:ItemsRepeater.Layout>
                                                            <muxc:UniformGridLayout MinItemWidth="90" ItemsStretch="Fill" MinItemHeight="32" MinColumnSpacing="4" MinRowSpacing="4"/>
                                                        </muxc:ItemsRepeater.Layout>
                                                        <muxc:ItemsRepeater.ItemTemplate>
                                                            <DataTemplate x:DataType="data:Kaomoji">
                                                                <Button Tag="{x:Bind}" Padding="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" HorizontalContentAlignment="Center" Click="RenderKaomoji">
                                                                    <TextBlock TextAlignment="Center" VerticalAlignment="Center" FontSize="12" LineHeight="12" LineStackingStrategy="BlockLineHeight" Text="{x:Bind Text}"/>
                                                                </Button>
                                                            </DataTemplate>
                                                        </muxc:ItemsRepeater.ItemTemplate>
                                                    </muxc:ItemsRepeater>
                                                </StackPanel>
                                            </DataTemplate>
                                        </muxc:ItemsRepeater.ItemTemplate>
                                    </muxc:ItemsRepeater>
                                </ScrollViewer>
                            </muxc:ItemsRepeaterScrollHost>
                        </PivotItem>
                    </Pivot>
                </Grid>
            </SplitView.Pane>
        </SplitView>
    </Grid>
</elor:Modal>