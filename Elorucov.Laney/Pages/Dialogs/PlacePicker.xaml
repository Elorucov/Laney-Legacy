<elor:Modal
    x:Class="Elorucov.Laney.Pages.Dialogs.PlacePicker"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Pages.Dialogs"
    xmlns:map="using:Windows.UI.Xaml.Controls.Maps"
    xmlns:elor="using:Elorucov.Toolkit.UWP.Controls"
    xmlns:vk="using:Elorucov.VkAPI.Objects"
    xmlns:vkui="using:VK.VKUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Style="{StaticResource ContentUnderTitleBarModalStyle}" FullSizeDesired="True" MaxWidth="540" MaxHeight="640" Loaded="OnLoaded">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border x:Name="HeaderBackground" Background="{ThemeResource LayerFillColorAltBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,0,1"/>

        <Grid Margin="12,48,12,13" Height="240">
            <map:MapControl x:Name="Map" x:DeferLoadStrategy="Lazy" Height="240" ZoomLevel="14" MapServiceToken="UiW7WOb2oHEe9yQSEVpg~53Z_RFeFeK1NCE1sIE_-Kw~Apg8QKsKCmrLWTa6BttNQVkUvaDQJjwCmgv8814SFKD2SmHWNIOJEUKpp8MDO-GP" CenterChanged="TrySearchPlaces"/>
            <Ellipse Fill="Red" Stroke="Black" StrokeThickness="2" Width="16" Height="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            <TextBlock x:Name="positionCoords" VerticalAlignment="Bottom" Margin="6" Foreground="#000" FontFamily="Lucida Console" FontSize="10" TextWrapping="Wrap"/>
        </Grid>

        <ListView x:Name="FoundPlacesList" Grid.Row="1" SelectionMode="None" IsItemClickEnabled="True" ItemClick="FoundPlacesList_ItemClick">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="vk:PlaceSearchResponse">
                    <Grid Margin="-4,6" Height="48">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Border Width="48" Height="48" CornerRadius="24" Margin="0,0,12,0" Background="{ThemeResource AccentFillColorDefaultBrush}">
                            <vkui:VKIcon HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{ThemeResource SolidBackgroundFillColorBaseBrush}" Id="Icon24Place"/>
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock FontWeight="SemiBold" Text="{x:Bind Place.Title}"/>
                            <TextBlock Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}">
                                <Run Text="{x:Bind Distance}"/>
                                <Run Text="m"/>
                                <Run Text="•"/>
                                <Run Text="{x:Bind Place.Address}"/>
                            </TextBlock>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <Border Grid.Row="1" VerticalAlignment="Bottom" Height="24" Background="{ThemeResource GradientUnderModalButtonBrush}"/>
        
        <TextBlock x:Name="LocationDisabledMessage" Grid.Row="2" Margin="12,9,12,12" Visibility="Collapsed" TextWrapping="Wrap">
                    <Run x:Uid="atchpicker_geo_access1"/>
                    <Hyperlink NavigateUri="ms-settings:privacy-location"><Run x:Uid="atchpicker_geo_access2"/></Hyperlink>
        </TextBlock>
        <Button x:Name="AttachButton" Margin="12,0,12,12" Grid.Row="3" Style="{StaticResource AccentButtonStyle}" IsEnabled="False" HorizontalAlignment="Stretch" x:Uid="atchpicker_attach" Click="AttachAndClose"/>
    </Grid>
</elor:Modal>