<Page
    x:Class="Elorucov.Laney.Pages.StatsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Elorucov.Laney.Pages"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:elor="using:Elorucov.Toolkit.UWP.Controls"
    xmlns:ctrls="using:Elorucov.Laney.Controls"
    xmlns:mdl="using:Elorucov.Laney.Models"
    xmlns:mdl2="using:Elorucov.Laney.Models.Stats"
    xmlns:converters="using:Elorucov.Laney.Services.Converters"
    xmlns:converters2="using:Elorucov.Laney.Services.Converters.MessageItem"
    xmlns:contract7Present="http://schemas.microsoft.com/winfx/2006/xaml/presentation?IsApiContractPresent(Windows.Foundation.UniversalApiContract,7)"
    xmlns:contract7NotPresent="http://schemas.microsoft.com/winfx/2006/xaml/presentation?IsApiContractNotPresent(Windows.Foundation.UniversalApiContract,7)"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d" x:Name="LayoutRoot" Loaded="StatsPage_Loaded"
    Background="{ThemeResource MicaLikeAcrylicWindowBrush}">

    <Page.Resources>
        <converters:Int64ToInt32 x:Key="i64"/>
        <converters:ReactionImageConverter x:Key="ric"/>
        <converters2:NullToVisibility x:Key="ntv"/>
        <converters2:NullToVisibility2 x:Key="vtn"/>

        <contract7Present:Style x:Key="NavigationButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonWithCornerRadiusStyle}">
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="MinWidth" Value="0"/>
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="FontFamily" Value="{StaticResource SymbolThemeFontFamily}"/>
            <Setter Property="FontSize" Value="12"/>
        </contract7Present:Style>

        <contract7NotPresent:Style x:Key="NavigationButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="MinWidth" Value="0"/>
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="FontFamily" Value="{StaticResource SymbolThemeFontFamily}"/>
            <Setter Property="FontSize" Value="12"/>
        </contract7NotPresent:Style>

        <Style x:Key="ResultListStyle" TargetType="ListView">
            <Setter Property="SelectionMode" Value="None"/>
            <Setter Property="ItemContainerTransitions" Value="{x:Null}"/>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ListViewItem">
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="MinHeight" Value="0"/>
                        <Setter Property="HorizontalAlignment" Value="Stretch"/>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="HorizontalResultListStyle" TargetType="ListView" BasedOn="{StaticResource ResultListStyle}">
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Hidden"/>
            <Setter Property="ScrollViewer.HorizontalScrollMode" Value="Auto"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.VerticalScrollMode" Value="Disabled"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <StackPanel Margin="6,0" Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ListViewItem">
                        <Setter Property="VerticalAlignment" Value="Top"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="Padding" Value="0"/>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="VerticalResultListStyle" TargetType="ListView" BasedOn="{StaticResource ResultListStyle}">
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <StackPanel Style="{StaticResource CardStyleS}" Margin="0,0,0,-1"/>
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ChipsGridViewStyle" TargetType="GridView">
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <ctrls:WrapPanel Margin="0,0,0,-3"/>
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="GridViewItem">
                        <Style.Setters>
                            <Setter Property="MinWidth" Value="0" />
                            <Setter Property="MinHeight" Value="0" />
                            <Setter Property="Margin" Value="0" />
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="GridViewItem">
                                        <GridViewItemPresenter BorderBrush="Transparent" FocusBorderBrush="Transparent"/>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style.Setters>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <DataTemplate x:Key="CounterTemplate" x:DataType="mdl:Entity">
            <Grid BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" Padding="0,0,0,1" BorderThickness="0,0,0,1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <ctrls:FixedFontIcon Margin="12,12,0,12" Glyph="{x:Bind Title}" VerticalAlignment="Top"/>
                <TextBlock Grid.Column="1" Margin="12,11,12,13" Text="{x:Bind Subtitle}"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="CounterTemplateNC">
            <Grid BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" Padding="0,0,0,1" BorderThickness="0,0,0,1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <ctrls:FixedFontIcon Margin="12,12,0,12" Glyph="{Binding Title}" VerticalAlignment="Top"/>
                <TextBlock Grid.Column="1" Margin="12,11,12,13" Text="{Binding Subtitle}"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="StickersCounterTemplate" x:DataType="mdl:Entity">
            <StackPanel Width="64" Margin="6,12">
                <Image Width="64" Height="64" Source="{x:Bind Image, Converter={StaticResource bic}, ConverterParameter='sticker1'}"/>
                <TextBlock Margin="0,9,0,0" TextAlignment="Center" Text="{x:Bind Title}"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="MemberTemplate" x:DataType="mdl:Entity">
            <Grid BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" Padding="0,0,0,1" BorderThickness="0,0,0,1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <Border Margin="12,0,0,0" Width="24">
                    <TextBlock FontSize="13" LineHeight="16" VerticalAlignment="Center" TextAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="{Binding Id}"/>
                </Border>
                <elor:Avatar Grid.Column="1" Margin="12" Width="48" Height="48" DisplayName="{Binding Title}" ImageUri="{Binding Image}"/>
                <TextBlock Grid.Column="2" Margin="0,16,6,0" VerticalAlignment="Top" Text="{x:Bind Title}"/>
                <TextBlock Grid.Column="2" VerticalAlignment="Bottom" Margin="0,0,6,18" FontSize="13" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="{x:Bind Subtitle}"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="WordTemplate" x:DataType="mdl:Entity">
            <Border Margin="0,0,6,6" Height="32" Background="{ThemeResource ControlFillColorDefaultBrush}" BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="4">
                <StackPanel Orientation="Horizontal" Background="Transparent">
                    <TextBlock Margin="8,4,6,4" FontFamily="{StaticResource ContentControlThemeFontFamily}" Text="{x:Bind Title}" Style="{StaticResource BodyTextBlockStyle}"/>
                    <muxc:InfoBadge Margin="0,0,8,0" Value="{x:Bind Id, Converter={StaticResource i64}}"/>
                </StackPanel>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="ReactionTemplate" x:DataType="mdl:Entity">
            <Border Margin="0,0,6,6" Height="32" Background="{ThemeResource ControlFillColorDefaultBrush}" BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="4">
                <StackPanel Orientation="Horizontal" Background="Transparent">
                    <Image Width="22" Height="22" Margin="4,4,4,6" DataContextChanged="ReactionImage_DataContextChanged"/>
                    <TextBlock Margin="0,5,8,0" FontWeight="SemiBold" FontFamily="{StaticResource ContentControlThemeFontFamily}" Text="{x:Bind Title}" Style="{StaticResource BodyTextBlockStyle}"/>
                </StackPanel>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="ResultsTemplateNarrow" x:DataType="mdl2:StatsResult">
            <StackPanel x:Name="ResultsTemplateNarrowRoot"  MaxWidth="616" SizeChanged="ResultsViewSizeChanged">
                <StackPanel x:Name="CountersView" Margin="0,12,0,0" Visibility="{x:Bind General, Converter={StaticResource ntv}}">
                    <TextBlock Margin="0,4,0,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_results"/>
                    <ListView Style="{StaticResource VerticalResultListStyle}" ItemTemplate="{StaticResource CounterTemplate}" ItemsSource="{x:Bind General}"/>
                </StackPanel>

                <StackPanel x:Name="AttachmentsCountersView" Margin="0,12,0,0" Visibility="{x:Bind Attachments, Converter={StaticResource ntv}}">
                    <TextBlock Margin="0,4,0,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_attachments"/>
                    <ListView Style="{StaticResource VerticalResultListStyle}" ItemTemplate="{StaticResource CounterTemplateNC}" ItemsSource="{x:Bind Attachments}"/>
                </StackPanel>

                <StackPanel x:Name="StickersTopView" Margin="1,12,1,0" Visibility="{x:Bind TopStickers, Converter={StaticResource ntv}}">
                    <StackPanel Orientation="Horizontal" Margin="-1,4,-1,8">
                        <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_stickers"/>
                        <Button Margin="12,0,0,0" Style="{StaticResource NavigationButtonStyle}" Content="" Tag="{Binding ElementName=StickersTopLV}" Click="ScrollToLeft"/>
                        <Button Margin="3,0,0,0" Style="{StaticResource NavigationButtonStyle}" Content="" Tag="{Binding ElementName=StickersTopLV}" Click="ScrollToRight"/>
                    </StackPanel>
                    <StackPanel Style="{StaticResource CardStyleS}">
                        <ListView x:Name="StickersTopLV" Style="{StaticResource HorizontalResultListStyle}" ItemTemplate="{StaticResource StickersCounterTemplate}" ItemsSource="{x:Bind TopStickers}" PointerEntered="HLV_PointerEntered" PointerExited="HLV_PointerExited"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel x:Name="UGCStickersTopView" Margin="1,12,1,0" Visibility="{x:Bind TopUGCStickers, Converter={StaticResource ntv}}">
                    <StackPanel Orientation="Horizontal" Margin="-1,4,-1,8">
                        <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_ugc_stickers"/>
                        <Button Margin="12,0,0,0" Style="{StaticResource NavigationButtonStyle}" Content="" Tag="{Binding ElementName=UGCStickersTopLV}" Click="ScrollToLeft"/>
                        <Button Margin="3,0,0,0" Style="{StaticResource NavigationButtonStyle}" Content="" Tag="{Binding ElementName=UGCStickersTopLV}" Click="ScrollToRight"/>
                    </StackPanel>
                    <StackPanel Style="{StaticResource CardStyleS}">
                        <ListView x:Name="UGCStickersTopLV" Style="{StaticResource HorizontalResultListStyle}" ItemTemplate="{StaticResource StickersCounterTemplate}" ItemsSource="{x:Bind TopUGCStickers}" PointerEntered="HLV_PointerEntered" PointerExited="HLV_PointerExited"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel x:Name="TopMembersView" Margin="1,12,1,0" Visibility="{x:Bind TopMembers, Converter={StaticResource ntv}}">
                    <TextBlock Margin="-1,4,-1,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_members"/>
                    <Grid x:Name="TopMembersTabs">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <Border x:Name="TopMembersTabsHeader" Style="{StaticResource CardStyleB}" Height="48" CornerRadius="8,8,0,0">
                            <GridView x:Name="TopMembersTabsGV" Margin="7,0" Style="{StaticResource SegmentedTabStyle}" VerticalAlignment="Center" ItemsSource="{x:Bind TopMembers}" DataContextChanged="SelectFirstTab" Tag="{Binding ElementName=TopMembersTabs}" SelectionChanged="ScrollToBlockStart">
                                <GridView.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Margin="8,6,8,7" FontWeight="SemiBold" Text="{Binding Key}" Style="{StaticResource BodyTextBlockStyle}"/>
                                    </DataTemplate>
                                </GridView.ItemTemplate>
                            </GridView>
                        </Border>
                        <StackPanel x:Name="TopMembersListWrap" Grid.Row="1" Style="{StaticResource CardStyleS}" BorderThickness="1,0,1,1" CornerRadius="0,0,8,8">
                            <ListView Style="{StaticResource ResultListStyle}" ItemTemplate="{StaticResource MemberTemplate}" ItemsSource="{Binding SelectedItem.Value, ElementName=TopMembersTabsGV}" ScrollViewer.VerticalScrollMode="Disabled"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>

                <StackPanel x:Name="TopMembersByReactionsView" Margin="1,12,1,0" Visibility="{x:Bind TopMembersByReactions, Converter={StaticResource ntv}}">
                    <TextBlock Margin="-1,4,-1,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_members_by_reactions"/>
                    <Grid x:Name="TopMembersByReactionsTabs">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <Border x:Name="TopMembersByReactionsTabsHeader" Style="{StaticResource CardStyleB}" Height="48" CornerRadius="8,8,0,0">
                            <GridView x:Name="TopMembersByReactionsTabsGV" Margin="7,0" Style="{StaticResource SegmentedTabStyle}" VerticalAlignment="Center" ItemsSource="{x:Bind TopMembersByReactions}" DataContextChanged="SelectFirstTab" Tag="{Binding ElementName=TopMembersByReactionsTabs}" SelectionChanged="ScrollToBlockStart">
                                <GridView.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="8,0">
                                            <ContentPresenter Height="22" MinWidth="22" VerticalAlignment="Center" FontSize="14" LineHeight="14" FontWeight="SemiBold" Content="{Binding Item1, Converter={StaticResource ric}}"/>
                                            <TextBlock Margin="6,-1,0,0" VerticalAlignment="Center" FontSize="14" LineHeight="14" FontWeight="Normal" Text="{Binding Item2}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridView.ItemTemplate>
                            </GridView>
                        </Border>
                        <StackPanel x:Name="TopMembersByReactionsListWrap" Grid.Row="1" Style="{StaticResource CardStyleS}" BorderThickness="1,0,1,1" CornerRadius="0,0,8,8">
                            <ListView Style="{StaticResource ResultListStyle}" ItemTemplate="{StaticResource MemberTemplate}" ItemsSource="{Binding SelectedItem.Item3, ElementName=TopMembersByReactionsTabsGV}" ScrollViewer.VerticalScrollMode="Disabled"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>

                <StackPanel x:Name="WordsTopView" Margin="0,12,0,0" Visibility="{x:Bind TopWords, Converter={StaticResource ntv}}">
                    <TextBlock Margin="0,4,0,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_words"/>
                    <GridView Style="{StaticResource ChipsGridViewStyle}" ItemTemplate="{StaticResource WordTemplate}" ItemsSource="{x:Bind TopWords}"/>
                </StackPanel>

                <StackPanel x:Name="TechInfoView" Margin="1,12,1,0" Visibility="{x:Bind TechnicalInfo, Converter={StaticResource ntv}}">
                    <TextBlock Margin="-1,4,-1,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_tech_info"/>
                    <Border Style="{StaticResource CardStyleB}" HorizontalAlignment="Left">
                        <TextBlock Margin="12,9,12,12" TextWrapping="Wrap" Text="{x:Bind TechnicalInfo}"/>
                    </Border>
                </StackPanel>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="ResultsTemplateWide" x:DataType="mdl2:StatsResult">
            <StackPanel x:Name="ResultsTemplateWideRoot" SizeChanged="ResultsViewSizeChanged">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <StackPanel x:Name="CountersView" Margin="0,12,6,0" Visibility="{x:Bind General, Converter={StaticResource ntv}}">
                        <TextBlock Margin="0,4,0,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_results"/>
                        <ListView Style="{StaticResource VerticalResultListStyle}" ItemTemplate="{StaticResource CounterTemplate}" ItemsSource="{x:Bind General}"/>
                    </StackPanel>

                    <StackPanel x:Name="AttachmentsCountersView" Grid.Column="1" Margin="6,12,0,0" Visibility="{x:Bind Attachments, Converter={StaticResource ntv}}">
                        <TextBlock Margin="0,4,0,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_attachments"/>
                        <ListView Style="{StaticResource VerticalResultListStyle}" ItemTemplate="{StaticResource CounterTemplateNC}" ItemsSource="{x:Bind Attachments}"/>
                    </StackPanel>
                </Grid>

                <StackPanel x:Name="StickersTopView" Margin="1,12,1,0" Visibility="{x:Bind TopStickers, Converter={StaticResource ntv}}">
                    <StackPanel Orientation="Horizontal" Margin="-1,4,-1,8">
                        <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_stickers"/>
                        <Button Margin="12,0,0,0" Style="{StaticResource NavigationButtonStyle}" Content="" Tag="{Binding ElementName=StickersTopLV}" Click="ScrollToLeft"/>
                        <Button Margin="3,0,0,0" Style="{StaticResource NavigationButtonStyle}" Content="" Tag="{Binding ElementName=StickersTopLV}" Click="ScrollToRight"/>
                    </StackPanel>
                    <StackPanel Style="{StaticResource CardStyleS}">
                        <ListView x:Name="StickersTopLV" Style="{StaticResource HorizontalResultListStyle}" ItemTemplate="{StaticResource StickersCounterTemplate}" ItemsSource="{x:Bind TopStickers}" PointerEntered="HLV_PointerEntered" PointerExited="HLV_PointerExited"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel x:Name="UGCStickersTopView" Margin="1,12,1,0" Visibility="{x:Bind TopUGCStickers, Converter={StaticResource ntv}}">
                    <StackPanel Orientation="Horizontal" Margin="-1,4,-1,8">
                        <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_ugc_stickers"/>
                        <Button Margin="12,0,0,0" Style="{StaticResource NavigationButtonStyle}" Content="" Tag="{Binding ElementName=UGCStickersTopLV}" Click="ScrollToLeft"/>
                        <Button Margin="3,0,0,0" Style="{StaticResource NavigationButtonStyle}" Content="" Tag="{Binding ElementName=UGCStickersTopLV}" Click="ScrollToRight"/>
                    </StackPanel>
                    <StackPanel Style="{StaticResource CardStyleS}">
                        <ListView x:Name="UGCStickersTopLV" Style="{StaticResource HorizontalResultListStyle}" ItemTemplate="{StaticResource StickersCounterTemplate}" ItemsSource="{x:Bind TopUGCStickers}" PointerEntered="HLV_PointerEntered" PointerExited="HLV_PointerExited"/>
                    </StackPanel>
                </StackPanel>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <StackPanel x:Name="TopMembersView" Margin="1,12,6,0" Visibility="{x:Bind TopMembers, Converter={StaticResource ntv}}">
                        <TextBlock Margin="-1,4,-1,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_members"/>
                        <Grid x:Name="TopMembersTabs">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <Border x:Name="TopMembersTabsHeader" Style="{StaticResource CardStyleB}" Height="48" CornerRadius="8,8,0,0">
                                <GridView x:Name="TopMembersTabsGV" Margin="7,0" Style="{StaticResource SegmentedTabStyle}" VerticalAlignment="Center" ItemsSource="{x:Bind TopMembers}" Tag="{Binding ElementName=TopMembersTabs}" DataContextChanged="SelectFirstTab" SelectionChanged="ScrollToBlockStart">
                                    <GridView.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Margin="8,6,8,7" FontWeight="SemiBold" Text="{Binding Key}" Style="{StaticResource BodyTextBlockStyle}"/>
                                        </DataTemplate>
                                    </GridView.ItemTemplate>
                                </GridView>
                            </Border>
                            <StackPanel x:Name="TopMembersListWrap" Grid.Row="1" Style="{StaticResource CardStyleS}" BorderThickness="1,0,1,1" CornerRadius="0,0,8,8">
                                <ListView Style="{StaticResource ResultListStyle}" ItemTemplate="{StaticResource MemberTemplate}" ItemsSource="{Binding SelectedItem.Value, ElementName=TopMembersTabsGV}" ScrollViewer.VerticalScrollMode="Disabled"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>

                    <StackPanel x:Name="TopMembersByReactionsView" Grid.Column="1" Margin="6,12,1,0" Visibility="{x:Bind TopMembersByReactions, Converter={StaticResource ntv}}">
                        <TextBlock Margin="-1,4,-1,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_members_by_reactions"/>
                        <Grid x:Name="TopMembersByReactionsTabs">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <Border x:Name="TopMembersByReactionsTabsHeader" Style="{StaticResource CardStyleB}" Height="48" CornerRadius="8,8,0,0">
                                <GridView x:Name="TopMembersByReactionsTabsGV" Margin="7,0" Style="{StaticResource SegmentedTabStyle}" VerticalAlignment="Center" ItemsSource="{x:Bind TopMembersByReactions}" DataContextChanged="SelectFirstTab" Tag="{Binding ElementName=TopMembersByReactionsTabs}" SelectionChanged="ScrollToBlockStart">
                                    <GridView.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Margin="8,0">
                                                <ContentPresenter Height="22" MinWidth="22" VerticalAlignment="Center" FontSize="14" LineHeight="14" FontWeight="SemiBold" Content="{Binding Item1, Converter={StaticResource ric}}"/>
                                                <TextBlock Margin="6,-1,0,0" VerticalAlignment="Center" FontSize="14" LineHeight="14" FontWeight="Normal" Text="{Binding Item2}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridView.ItemTemplate>
                                </GridView>
                            </Border>
                            <StackPanel x:Name="TopMembersByReactionsListWrap" Grid.Row="1" Style="{StaticResource CardStyleS}" BorderThickness="1,0,1,1" CornerRadius="0,0,8,8">
                                <ListView Style="{StaticResource ResultListStyle}" ItemTemplate="{StaticResource MemberTemplate}" ItemsSource="{Binding SelectedItem.Item3, ElementName=TopMembersByReactionsTabsGV}" ScrollViewer.VerticalScrollMode="Disabled"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Grid>

                <StackPanel x:Name="WordsTopView" Margin="0,12,0,0" Visibility="{x:Bind TopWords, Converter={StaticResource ntv}}">
                    <TextBlock Margin="0,4,0,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_top_words"/>
                    <GridView Style="{StaticResource ChipsGridViewStyle}" ItemTemplate="{StaticResource WordTemplate}" ItemsSource="{x:Bind TopWords}"/>
                </StackPanel>

                <StackPanel x:Name="TechInfoView" Margin="1,12,1,0" Visibility="{x:Bind TechnicalInfo, Converter={StaticResource ntv}}">
                    <TextBlock Margin="-1,4,-1,8" Style="{StaticResource BodyStrongTextBlockStyle}" x:Uid="stats_tech_info"/>
                    <Border Style="{StaticResource CardStyleB}" HorizontalAlignment="Left">
                        <TextBlock Margin="12,9,12,12" TextWrapping="Wrap" Text="{x:Bind TechnicalInfo}"/>
                    </Border>
                </StackPanel>
            </StackPanel>
        </DataTemplate>
    </Page.Resources>

    <Grid x:Name="Root" MaxWidth="1280" Margin="12,0,12,0">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState x:Name="Narrow">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="ResultsViewRoot.ContentTemplate" Value="{StaticResource ResultsTemplateNarrow}"/>
                        <Setter Target="ShareButtonText.Visibility" Value="Collapsed"/>
                    </VisualState.Setters>
                </VisualState>
                
                <VisualState x:Name="Wide">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="768"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="ResultsViewRoot.ContentTemplate" Value="{StaticResource ResultsTemplateWide}"/>
                        <Setter Target="ShareButtonText.Visibility" Value="Visible"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <Grid Margin="0,32,0,0" Padding="0,6" Visibility="{Binding Name, Converter={StaticResource ntv}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <elor:Avatar IsHitTestVisible="False" Width="48" Height="48" Margin="0,0,12,0" ImageSource="{Binding Avatar, Converter={StaticResource bic}, ConverterParameter=ava, Mode=OneWay}" DisplayName="{Binding Name, Mode=OneWay}"/>

            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" TextLineBounds="TrimToBaseline" FontSize="16">
                    <TextBlock.RenderTransform>
                        <CompositeTransform TranslateY="-3"/>
                    </TextBlock.RenderTransform>
                </TextBlock>
                <TextBlock FontSize="13" LineHeight="16" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextTrimming="CharacterEllipsis" Text="{Binding Info, Mode=OneWay}"/>
            </StackPanel>

            <Button Grid.Column="2" Visibility="{Binding Result, Converter={StaticResource ntv}}" x:Uid="exportB" Click="StartExport">
                <StackPanel Orientation="Horizontal">
                    <ctrls:FixedFontIcon Glyph=""/>
                    <TextBlock x:Name="ShareButtonText" Margin="8,0,0,0" x:Uid="export"/>
                </StackPanel>
            </Button>
        </Grid>
        <!--<Rectangle x:Name="Separator" VerticalAlignment="Bottom" Margin="0,12,0,0" Height="1" Fill="{ThemeResource DividerStrokeColorDefaultBrush}"/>-->

        <Grid Grid.Row="1" Margin="0,0,0,54" Visibility="{Binding IsInSetupMode, Converter={StaticResource ntv}}">
            <Grid Visibility="{Binding IsLoading, Mode=OneWay, Converter={StaticResource vtn}}" Style="{StaticResource CardStyle}" VerticalAlignment="Center" MaxWidth="300">
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <CalendarView x:Name="Calendar" Background="Transparent" HorizontalAlignment="Stretch" BorderThickness="0" SelectionMode="Multiple" SelectedDatesChanged="Calendar_SelectedDatesChanged" FirstDayOfWeek="Monday" IsTodayHighlighted="False" NumberOfWeeksInView="5" MinDate="{Binding StartDate, Mode=OneWay}" MaxDate="{Binding EndDate, Mode=OneWay}"/>

                <Grid Grid.Row="1" BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
                    <TextBlock x:Name="DateSelectionInfo" Margin="12,9,12,0" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </Grid>

                <Grid Grid.Row="2" Padding="6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button x:Name="SelectAllPeriodButton" Margin="6" HorizontalAlignment="Stretch" x:Uid="all_period_btn" Click="SelectAllPeriod"/>
                    <Button x:Name="CalcButton" Grid.Column="1" Margin="6" Style="{StaticResource AccentButtonStyle}" IsEnabled="False" x:Uid="calculate_btn" Command="{Binding CalcCommand, Mode=OneWay}"/>
                </Grid>
            </Grid>

            <Grid Grid.Row="1" Height="280" MaxWidth="320" Visibility="{Binding IsLoading, Converter={StaticResource ntv}}">
                <ctrls:RadialProgressBar VerticalAlignment="Top" Width="232" Height="232" Value="{Binding CurrentProgress, Mode=OneWay}"/>
                <Border VerticalAlignment="Top" Width="232" Height="232">
                    <TextBlock TextAlignment="Center" VerticalAlignment="Center" LineStackingStrategy="BlockLineHeight" LineHeight="64" FontSize="64" FontWeight="SemiLight">
                        <Run Text="{Binding CurrentProgress, Mode=OneWay}"/><Run Text="%"/>
                    </TextBlock>
                </Border>
                <TextBlock x:Name="ProgressInfo" VerticalAlignment="Bottom" TextAlignment="Center" TextWrapping="Wrap" Text="{Binding CurrentProgressInfo, Mode=OneWay}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </Grid>
        </Grid>

        <ScrollViewer x:Name="ResultsViewSV" Grid.Row="1" Visibility="{Binding Result, Converter={StaticResource ntv}}">
            <ContentPresenter x:Name="ResultsViewRoot" Margin="0,0,0,48" Content="{Binding Result}"/>
        </ScrollViewer>

        <StackPanel Grid.Column="1" Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="16,0" Padding="24,0" CornerRadius="{StaticResource OverlayCornerRadius}" Visibility="{Binding Placeholder, Converter={StaticResource ntv}}">
            <ctrls:FixedFontIcon Margin="0,24,0,0" FontSize="48" Glyph="{Binding Placeholder.Icon}"/>
            <TextBlock Margin="0,10,0,0" TextAlignment="Center" TextWrapping="Wrap" Style="{StaticResource SubtitleTextBlockStyle}" Visibility="{Binding Placeholder.Header, Converter={StaticResource ntv}}" Text="{Binding Placeholder.Header}"/>
            <TextBlock Margin="0,10,0,0" TextAlignment="Center" TextWrapping="Wrap" Style="{StaticResource BodyTextBlockStyle}" Visibility="{Binding Placeholder.Content, Converter={StaticResource ntv}}" Text="{Binding Placeholder.Content}"/>
            <Button Margin="0,16,0,24" Tag="retry" HorizontalAlignment="Center" Style="{StaticResource AccentButtonStyle}" Visibility="{Binding Placeholder.ActionButton, Converter={StaticResource ntv}}" Content="{Binding Placeholder.ActionButton}" Command="{Binding Placeholder.ActionButtonCommand, Mode=OneWay}"/>
        </StackPanel>

        <Border x:Name="DbgRAMContainer" Visibility="Collapsed" IsHitTestVisible="False" HorizontalAlignment="Right" Margin="0,7,146,0" VerticalAlignment="Top">
            <TextBlock x:Name="DbgRAM" FontFamily="Lucida Console" FontSize="10" Margin="0,4,0,2"/>
        </Border>
    </Grid>
</Page>